<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Rekap DO Salsanew GSMT</title>
  <!-- Tambahkan sebelum script Anda -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #f0fdf4; margin:0; padding:20px }
    h2 { color:#14532d }
    .card { background:#22c55e; padding:16px; border-radius:12px; margin-bottom:16px; box-shadow:0 1px 4px rgba(0,0,0,0.1) }
    input, select, button { padding:8px; margin:8px 0; width:100%; border-radius:8px; border:1px solid #ccc; box-sizing:border-box }
    .toolbar button { width:auto; margin-right:10px }
    button { background:#22c55e; color:white; border:none; cursor:pointer }
    button:hover { background:#16a34a }
    table { width:100%; border-collapse:collapse; margin-top:12px }
    th, td { border:1px solid #ccc; padding:6px; text-align:center }
    th { background:#4ade80; color:#064e3b }
    .edit-barang input { width:auto; margin:0 4px; padding:4px }
    .status-belum {
  background-color: #fecaca; /* merah muda */
  color: #991b1b; /* merah tua */
  font-weight: bold;
}

/* Style untuk card toolbar */
.card.toolbar {
  background-color: #bbf7d0; /*  */
  border: none;
  padding: 12px 16px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Style untuk tombol di dalam toolbar */
.card.toolbar button {
  background-color: #22c55e; /* Semi transparan */
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  font-family: Tahoma, sans-serif;
  font-size: 14px;
  font-weight: bold;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.card.toolbar button:hover {
  background-color: rgba(255, 255, 255, 0.3); /* Lebih terang saat hover */
  transform: translateY(-1px);
}

/* Style untuk card di dalam toolbar (search box) */
.card.toolbar .card {
  background-color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0;
  flex-grow: 1;
}

/* Style untuk input di dalam toolbar */
.card.toolbar input[type="text"],
.card.toolbar input[type="date"] {
  background-color: white;
  border: 1px solid #d1d5db;
  padding: 8px 12px;
  border-radius: 8px;
  font-family: Tahoma, sans-serif;
}

/* Responsive design */
@media (max-width: 768px) {
  .card.toolbar {
    flex-direction: column;
    gap: 8px;
  }
  
  .card.toolbar button {
    width: 100%;
    justify-content: center;
  }
}
.do-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.do-meta select {
  padding: 2px 8px;
  font-family: Tahoma, sans-serif;
  font-size: 14px;
  height: auto;
  margin-top: -3px;
  vertical-align: middle;
}

.do-card {
  background: white;
  border-radius: 12px;
  padding: 16px;
  border: 1px solid #ccc;
  box-shadow: 0 1px 1px rgba(0,0,0,0.1);
}
.do-card table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
.do-card th, .do-card td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: center;
}
.do-card th {
  background-color: #78350f;
  color: #bbf7d0;
}
.status-belum {
  background-color: #fecaca;
  color: #991b1b;
  font-weight: bold;
  border-color: #991b1b;
}
.do-card table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 10px;
  overflow: hidden;
  border-radius: 8px;
}
.do-card th, .do-card td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: center;
}
.do-card th {
  background-color: #bbf7d0;
  color: #064e3b;
}
body {
  font-family: Tahoma, sans-serif;
  background: #f0fdf4;
  margin: 0;
  padding: 20px;
  font-weight: bold;
}
.do-card td:first-child {
  text-align: left;
  padding-left: 12px;
}
.do-card th:first-child,
.do-card td:first-child {
  text-align: center;
  padding-left: 0;
  width: 40px;
}
.do-card th:nth-child(2),
.do-card td:nth-child(2) {
  text-align: left;
  padding-left: 12px;
}
.card {
  background: #bbf7d0;
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 16px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}
/* Table dalam DO Card */
.do-card table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 10px;
  overflow: hidden;
  border-radius: 8px;
}

/* Header tabel */
.do-card th {
  background-color: #bbf7d0;
  color: #064e3b;
  padding: 6px;
  border: 1px solid #ddd;
  text-align: center;
}

/* Sel tabel */
.do-card td {
  padding: 6px;
  border: 1px solid #ddd;
}

/* Kolom No - rata tengah */
.do-card th:nth-child(1),
.do-card td:nth-child(1) {
  text-align: center;
  width: 40px;
}

/* Kolom Nama Barang - rata kiri */
.do-card th:nth-child(2),
.do-card td:nth-child(2) {
  text-align: left;
  padding-left: 12px;
}

/* Kolom Jumlah & Satuan - rata tengah */
.do-card th:nth-child(3),
.do-card td:nth-child(3),
.do-card th:nth-child(4),
.do-card td:nth-child(4) {
  text-align: center;
}

/* Kolom Harga & Total - rata kanan */
.do-card th:nth-child(5),
.do-card td:nth-child(5),
.do-card th:nth-child(6),
.do-card td:nth-child(6) {
  text-align: right;
  padding-right: 12px;
}
/* Tambahan khusus untuk total nota */
.do-card tr:last-child td:last-child {
  text-align: right;
  font-weight: bold;
  padding-right: 12px;
}
.header-image img {
  width: 100%;
  max-height: 200px;
  object-fit: cover;
  border-radius: 12px;
  margin-bottom: 20px;
}
h2 {
  color: #14532d;
  background: rgba(255, 255, 255, 0.8);
  padding: 8px 16px;
  border-radius: 8px;
  display: inline-block;
  margin: 12px auto;
}
.do-meta {
  display: grid;
  grid-template-columns: 120px 1fr; /* 120px untuk label, sisanya isi */
  margin-bottom: 4px;
  align-items: center;
}
.do-meta span.label {
  font-weight: bold;
  color: #064e3b;
}
.do-meta {
  display: flex;
  gap: 8px;
  margin-bottom: 4px;
  align-items: center;
  font-size: 14px;
}

.do-meta {
  display: flex;
  gap: 8px;
  margin-bottom: 4px;
  align-items: right;
  font-size: 14px;
  justify-content: flex-start; /* Pastikan baris mulai dari kiri */
}

.do-meta .label {
  min-width: 100px;
  font-weight: bold;
  display: flex;
  justify-content: flex-end; /* Hanya teks label diratakan kanan dalam ruang 100px */
}

.do-meta .value {
  flex: 1;
}
.do-meta-block {
  font-family: 'Courier New', monospace;
  font-size: 14px;
  background-color: #f9f9f9;
  padding: 8px;
  border-radius: 6px;
  white-space: pre-wrap;
}
.do-meta-block {
  font-family: 'Courier New', monospace;
  font-size: 14px;
  white-space: pre-wrap;
  margin-bottom: 4px;
}

.do-status {
  margin-top: -16px;
  margin-bottom: 12px;
  padding-left: 95px; /* sejajarkan dengan titik dua */
}
.do-meta-block {
  font-family: Tahoma, sans-serif;
  font-size: 15px;
  white-space: pre-wrap;
  margin-bottom: 4px;
  line-height: 1.5;
  background-color: #f9f9f9;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.do-status {
  margin-top: -16px;
  margin-bottom: 12px;
  padding-left: 95px; /* sejajarkan dengan titik dua */
}
.do-meta-block {
  font-family: Tahoma, sans-serif;
  font-size: 15px;
  line-height: 1.5;
  margin-bottom: 8px;
}

.do-meta-block .label {
  display: inline-block;
  width: 100px;
}

.do-meta-block .value {
  display: inline-block;
  vertical-align: middle;
}
.do-text {
  font-family: Tahoma, sans-serif;
  background: #f9fafb;
  padding: 12px;
  border-radius: 8px;
  white-space: pre-wrap;
  margin-bottom: 12px;
}
.do-text {
  font-family: 'Courier New', monospace;
  background: #f9fafb;
  padding: 8px 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  white-space: pre-wrap;
}

.status-row {
  display: flex;
  align-items: center;
  font-family: 'Courier New', monospace;
  margin-bottom: 12px;
  padding-left: 12px;
}

.status-row .label {
  min-width: 100px;
}

.status-row select {
  width: 140px;
  padding: 4px 6px;
  font-family: inherit;
  font-size: 14px;
}
.do-meta {
  display: flex;
  align-items: flex-start;
  gap: 6px;  /* jarak antara label dan value */
  font-family: Tahoma, sans-serif;
  margin-bottom: 8px;
}


.label {
  min-width: 90px;
  font-weight: bold;
}

.value {
  flex: 1;
}

.do-meta select {
  font-family: Tahoma, sans-serif;
  padding: 4px 6px;
  width: 140px;
  font-size: 14px;
}
.do-meta select {
  padding: 4px 8px;
  font-family: Tahoma, sans-serif;
  font-size: 14px;
  height: auto;
}
.do-meta select {
  padding: 2px 8px;        /* kurangi padding atas-bawah */
  margin-top: 8px;       /* naikkan sedikit posisi select */
  font-family: Tahoma, sans-serif;
  font-size: 14px;
  height: auto;
}
input[type="date"] {
  font-family: Tahoma, sans-serif;
}
<style>
.edit-input {
  width: 100%;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-family: Tahoma, sans-serif;
}
.edit-barang-btn {
  margin: 10px 0;
  background: #facc15;
  color: #78350f;
  font-weight: bold;
  padding: 6px 12px;
  border-radius: 8px;
}
.hps-barang-btn {
  margin: 10px 0;
  background: red;
  color: #14532d;
  font-weight: bold;
  padding: 6px 12px;
  border-radius: 8px;
}
.do-meta {
  display: grid;
  grid-template-columns: 120px 1fr; /* kolom label & isi */
  gap: 8px;
  align-items: center;
  margin-bottom: 6px;
}

.do-meta .label {
  text-align: right;   /* rata kanan */
  font-weight: bold;
  color: #064e3b;
}

.do-meta .value {
  text-align: left;    /* rata kiri */
}
.hapus-nota-btn {
  background: #ef4444;
  color: white;
  font-weight: bold;
  border-radius: 8px;
  padding: 6px 12px;
  margin-top: 8px;
  cursor: pointer;
}
/* Responsive table container */
.table-container {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

/* Table styles */
.do-card table {
  width: 100%;
  min-width: 600px; /* Minimum width for table */
  border-collapse: collapse;
  margin-top: 10px;
}

/* Responsive cells */
.do-card td, .do-card th {
  padding: 8px;
  text-align: left;
  border: 1px solid #ddd;
  word-break: break-word; /* Prevent long text from breaking layout */
}

/* Column sizing */
.do-card th:nth-child(1),
.do-card td:nth-child(1) {
  width: 5%;
  text-align: center;
}

.do-card th:nth-child(2),
.do-card td:nth-child(2) {
  width: 35%;
}

.do-card th:nth-child(3),
.do-card td:nth-child(3),
.do-card th:nth-child(4),
.do-card td:nth-child(4) {
  width: 10%;
  text-align: center;
}

.do-card th:nth-child(5),
.do-card td:nth-child(5),
.do-card th:nth-child(6),
.do-card td:nth-child(6) {
  width: 15%;
  text-align: right;
}

/* Mobile-specific styles */
@media screen and (max-width: 768px) {
  .do-card td, .do-card th {
    padding: 6px 4px;
    font-size: 14px;
  }
  
  .toolbar button {
    padding: 6px 8px;
    font-size: 18px;
    margin-right: 5px;
  }
  
  .do-meta {
    font-size: 14px;
  }
}
.do-meta select:hover {
  border-color: #4ade80;
}
.do-meta select {
  height: 28px; /* Tinggi tetap */
  line-height: 1; /* Untuk alignment teks yang lebih baik */
}
/* Toolbar Compact */
.card.toolbar-compact {
  background-color: #bbf7d0;
  padding: 10px 15px;
  border-radius: 12px;
  display: inline-flex; /* Menyusun menyamping tanpa wrap */
  gap: 8px;
}

/* Tombol Toolbar */
.card.toolbar-compact button {
  background-color: #22c55e;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  font-family: Tahoma, sans-serif;
  font-size: 14px;
  font-weight: bold;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: all 0.2s ease;
}

.card.toolbar-compact button:hover {
  background-color: rgba(255, 255, 255, 0.25);
  transform: translateY(-1px);
}

/* Tombol Export khusus */
.card.toolbar-compact button:nth-last-child(-n+2) {
  background-color: rgba(0, 0, 0, 0.15);
}

.card.toolbar-compact button:nth-last-child(-n+2):hover {
  background-color: rgba(0, 0, 0, 0.25);
}
<style>
  .swal2-popup {
    font-family: Tahoma, sans-serif;
    border-radius: 12px;
  }
  
  .swal2-title {
    color: #14532d;
    font-weight: bold;
  }
  
  .swal2-confirm {
    background-color: #22c55e !important;
  }
  
  .swal2-cancel {
    background-color: #ef4444 !important;
  }
  
  .swal2-toast {
    background: #22c55e;
    color: white;
    font-weight: bold;
  }
  #keterangan {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: Tahoma, sans-serif;
  margin-bottom: 8px;
}

.form-input {
  width: 100%;
  padding: 8px;
  margin: 8px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: Tahoma, sans-serif;
  box-sizing: border-box;
}

textarea.form-input {
  min-height: 60px;
  resize: vertical;
}

.edit-btn {
  background: none;
  border: none;
  color: #3b82f6;
  cursor: pointer;
  padding: 2px 5px;
  margin-left: 5px;
  font-size: 0.9em;
}

.edit-btn:hover {
  text-decoration: underline;
}
</style>



  </style>
</head>
<body>
<div class="header-image">
  <img src="https://i.imgur.com/8yVZybU.png"
     alt="Header Foto"
     style="width:100%; max-height:250px; object-fit:cover; border-radius:12px; margin-bottom:20px;">


</div>
<div style="text-align:center">
  <h2 class="h2">Catatan Delivery Order Salsanew GSMT</h2>
</div>
<div class="card">
  <input id="customer" placeholder="Nama Pelanggan" />
  <input id="tanggalDO" type="date" />
  <select id="status">
    <option value="BELUM LUNAS">BELUM LUNAS</option>
    <option value="LUNAS">LUNAS</option>
  </select>
  <textarea id="keterangan" placeholder="Keterangan tambahan (opsional)"
          rows="2" class="form-input"></textarea>
  <button onclick="buatDO()">Buat DO</button>
</div>
<div class="card" id="barangForm" style="display:none">
  <h3>Tambah Barang ke DO ‚Äì <span id="noDO"></span></h3>
  <form id="barangInputForm" onsubmit="event.preventDefault(); tambahBarang();">
    <input id="namaBarang" placeholder="Nama Barang" />
    <input id="qty" type="number" placeholder="Jumlah" />
    <input id="unit" placeholder="Satuan" />
    <input id="price" type="number" placeholder="Harga" />
    <button type="submit">Tambah Barang</button>
  </form>
  <button id="selesaiBtn" onclick="selesaiDO()" disabled>‚úÖ Selesai DO</button>
 </div>

<h2>Daftar DO</h2>
<div class="toolbar-even">
  <button onclick="resetFilter()">üîÑ Semua</button>
  <button onclick="filterBelumLunas()">üìã Belum Lunas</button>
  <button onclick="exportExcel()">üìÑ Export Excel</button>
  <button onclick="exportPDF()">üßæ Export PDF</button>
  <button onclick="cekHutangPerPelanggan()">üßæ Cek Hutang Pelanggan</button>
</div>

<style>
  /* Toolbar dengan lebar tombol merata */
  .toolbar-even {
    display: flex;
    gap: 6px;
    padding: 10px;
    background-color: #f0fdf4;
    border-radius: 8px;
    margin-bottom: 16px;
    width: 100%;
  }

  .toolbar-even button {
    flex: 1; /* Membagi lebar secara merata */
    background-color: #22c55e;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 5px;
    cursor: pointer;
    font-family: Tahoma, sans-serif;
    font-size: 14px;
    font-weight: bold;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    transition: all 0.2s ease;
    min-width: 0; /* Memungkinkan text overflow */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .toolbar-even button:hover {
    background-color: #16a34a;
  }

  /* Tombol Export */
  .toolbar-even button:nth-last-child(-n+2) {
    background-color: #3b82f6;
  }

  .toolbar-even button:nth-last-child(-n+2):hover {
    background-color: #2563eb;
  }

  /* Responsive untuk layar kecil */
  @media (max-width: 600px) {
    .toolbar-even {
      flex-wrap: wrap;
    }
    
    .toolbar-even button {
      flex: 1 0 calc(50% - 6px); /* 2 tombol per baris di mobile */
      margin-bottom: 6px;
    }
  }
</style>
    <div class="card" style="flex-grow: 1; min-width: 200px;">
      <input type="text" id="cariNama" placeholder="üîç Cari Nama Pelanggan atau No DO..." oninput="tampilkanDO()" />
    </div>
    <div class="card">
      <input type="date" id="tanggalCari" onchange="tampilkanDO()" />
    </div>
  </div>
</div>

<div class="card">
  <div id="daftarDO" class="do-list"></div>
</div>

<script>
async function selesaiDO() {
  // Konfirmasi penyelesaian
  const confirmResult = await Swal.fire({
    title: 'Selesaikan DO?',
    text: 'Anda yakin ingin menyelesaikan Delivery Order ini?',
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#22c55e',
    cancelButtonColor: '#ef4444',
    confirmButtonText: 'Ya, Selesaikan',
    cancelButtonText: 'Batal'
  });

  if (confirmResult.isConfirmed) {
    // Proses penyelesaian
    currentDO = { id: null, number: '' };
    document.getElementById('barangForm').style.display = 'none';
    document.getElementById('noDO').textContent = '';

    // Notifikasi sederhana di tengah
    await Swal.fire({
      title: 'Berhasil',
      text: 'Transaksi DO telah selesai',
      icon: 'success',
      confirmButtonText: 'OK',
      confirmButtonColor: '#22c55e'
    });

    tampilkanDO(); // Refresh data
  }
}

  const _supabase = supabase.createClient(
    'https://jdeettigwdvrapqrxyas.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkZWV0dGlnd2R2cmFwcXJ4eWFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2NjA2MzEsImV4cCI6MjA2NjIzNjYzMX0.6TCKXPVFvhUj3K6jRg6zWEJ9z4sxxu5FhWEXS7GWh5o'
  );
  let currentDO = { id:null, number:'' };

 async function buatDO() {
  const customer = document.getElementById('customer').value.trim();
  const status = document.getElementById('status').value;
  const tanggalInput = document.getElementById('tanggalDO').value;
  const dateObj = tanggalInput ? new Date(tanggalInput) : new Date();
  const number = 'DO-' + dateObj.toISOString().replace(/[-:T]/g, '').slice(0,14);
  const date = dateObj.toISOString().split('T')[0];
  const keterangan = document.getElementById('keterangan').value.trim();
// Tidak perlu validasi karena opsional
if (!customer) {
  return Swal.fire({
    icon: 'error',
    title: 'Oops...',
    text: 'Isi nama pelanggan terlebih dahulu!',
    confirmButtonColor: '#22c55e'
  });
}
  const { data, error } = await _supabase.from('do_list').insert([{ 
  number, customer, status, date, keterangan  // tambahkan field keterangan
}]).select();
  if (error) {
  return Swal.fire({
    icon: 'error',
    title: 'Gagal Simpan',
    html: `Terjadi kesalahan saat menyimpan DO:<br><br>
          <code style="background:#f0f0f0;padding:2px 5px;border-radius:3px">${error.message}</code>`,
    confirmButtonText: 'Mengerti'
  });
}
  currentDO = { id: data[0].id, number };
  document.getElementById('noDO').textContent = number;
  document.getElementById('barangForm').style.display = 'block';
  setupNavigasiInput(); // ‚Üê Di sini!
  document.getElementById('customer').value = '';
  document.getElementById('status').value = 'BELUM LUNAS';
  document.getElementById('selesaiBtn').disabled = true;
  document.getElementById('tanggalDO').value = '';
  tampilkanDO();
}


  async function selesaiDO() {
    currentDO = { id:null, number:'' };
    document.getElementById('barangForm').style.display='none';
    document.getElementById('noDO').textContent='';
    await Swal.fire({
  position: 'top-end',
  icon: 'success',
  title: 'Transaksi DO selesai! Berhasil disimpan',
  showConfirmButton: true,
  timer: 10000,
  toast: false
});
  }

  async function tambahBarang() {
    const name=document.getElementById('namaBarang').value.trim();
    const qty=parseFloat(document.getElementById('qty').value);
    const unit=document.getElementById('unit').value.trim();
    const price=parseFloat(document.getElementById('price').value);
    if (!name || !qty || !unit || !price) {
  return Swal.fire({
    icon: 'error',
    title: 'Form Tidak Lengkap',
    text: 'Urung Diisi Kabeh',
    confirmButtonColor: '#22c55e',
    confirmButtonText: 'Mengerti'
  });
}
    const { error } = await _supabase
      .from('do_items').insert([{ do_id:currentDO.id,name,qty,unit,price }]);
    if (error) return alert('Gagal tambah barang:'+error.message);
    ['namaBarang','qty','unit','price'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('namaBarang').focus();
    document.getElementById('selesaiBtn').disabled = false;
    tampilkanDO();
  }
async function ubahStatus(selectElement, doId) {
  const newStatus = selectElement.value;
  const { error } = await _supabase
    .from('do_list')
    .update({ status: newStatus })
    .eq('id', doId);
    
  if (error) {
    alert('Gagal update status: ' + error.message);
  } else {
    tampilkanDO();
  }
}
async function tampilkanDO(filterStatus = null) {
  const namaQuery = document.getElementById('cariNama')?.value.toLowerCase() || '';
  const tanggalFilter = document.getElementById('tanggalCari')?.value || '';

  const { data, error } = await _supabase
    .from('do_list')
    .select('*, do_items(*)')
    .order('created_at', { ascending: false });

  if (error) {
  return Swal.fire({
    icon: 'error',
    title: 'Gagal Mengambil Data',
    html: `
      <div style="text-align:left">
        <p>Terjadi kesalahan saat mengambil data:</p>
        <div style="background:#f8f8f8; padding:10px; border-radius:5px; margin-top:10px">
          <code>${error.message}</code>
        </div>
      </div>
    `,
    confirmButtonColor: '#22c55e',
    confirmButtonText: 'Mengerti'
  });
}
  const daftar = document.getElementById('daftarDO');
  daftar.innerHTML = '';

  const hasilFilter = data.filter(row => {
  const cocokNama = row.customer.toLowerCase().includes(namaQuery) || row.number.toLowerCase().includes(namaQuery);
  const cocokTanggal = tanggalFilter === '' || row.date === tanggalFilter;
  const cocokStatus = !filterStatus || row.status === filterStatus;
  return cocokNama && cocokTanggal && cocokStatus;
});


  hasilFilter.forEach(row => {
    const card = document.createElement('div');
    card.className = 'do-card';

    const total = row.do_items.reduce((sum, item) => sum + item.qty * item.price, 0);

    let tableHTML = `
      <table>
        <thead>
          <tr>
            <th>No</th>
            <th>Nama Barang</th>
            <th>Jumlah</th>
            <th>Satuan</th>
            <th>Harga</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          ${row.do_items.map((item, i) => `
            <tr>
              <td>${i + 1}</td>
              <td>${item.name}</td>
              <td>${item.qty}</td>
              <td>${item.unit}</td>
              <td>${item.price.toLocaleString('id-ID')}</td>
              <td>${(item.qty * item.price).toLocaleString('id-ID')}</td>
            </tr>
          `).join('')}
          <tr style="font-weight:bold; background:#bbf7d0;">
            <td colspan="5" style="text-align:right">Total Nota:</td>
            <td>${total.toLocaleString('id-ID')}</td>
          </tr>
        </tbody>
      </table>
    `;

  card.innerHTML = `
  <div class="do-meta">
    <span class="label">Tanggal:</span>
    <span class="value">${formatTanggalIndo(row.date)}</span>
  </div>
  <div class="do-meta">
    <span class="label">No DO:</span>
    <span class="value">${row.number}</span>
  </div>
  <div class="do-meta">
    <span class="label">Pelanggan:</span>
    <span class="value">${row.customer}</span>
  </div>
  <div class="do-meta">
    <span class="label">Status:</span>
    <span class="value">
      <select onchange="ubahStatus(this, '${row.id}')" class="${row.status === 'BELUM LUNAS' ? 'status-belum' : ''}">
        <option value="BELUM LUNAS" ${row.status === 'BELUM LUNAS' ? 'selected' : ''}>BELUM LUNAS</option>
        <option value="LUNAS" ${row.status === 'LUNAS' ? 'selected' : ''}>LUNAS</option>
      </select>
    </span>
  </div>

  <div class="do-meta">
    <span class="label">Keterangan:</span>
    <span class="value" id="keterangan-${row.id}">
      ${row.keterangan || '-'}
      <button onclick="editKeterangan('${row.id}')" class="edit-btn">‚úèÔ∏è Edit</button>
    </span>
  </div>


  <button onclick="toggleEditBarang('${row.id}')" class="edit-barang-btn">‚úèÔ∏è Edit Barang</button>
  <button onclick="hapusNota('${row.id}')" class="hapus-nota-btn">üóëÔ∏è Hapus Nota</button>
  <div id="barangContainer-${row.id}">
    ${renderBarangTable(row)}
  </div>
`;



    daftar.appendChild(card);
  });
}


  async function updateBarang(id,field,value) {
    const { error } = await _supabase.from('do_items').update({[field]:value}).eq('id',id);
    if (error) {
  await Swal.fire({
    icon: 'error',
    title: 'Update Gagal',
    html: `
      <div style="text-align:left">
        <p>Gagal memperbarui data barang:</p>
        <div style="background:#fef2f2; color:#b91c1c; padding:8px 12px; border-radius:6px; margin-top:8px; font-family:monospace; font-size:0.9em">
          ${error.message}
        </div>
        <p style="margin-top:12px; font-size:0.9em">Silakan coba lagi atau hubungi Isnan :).</p>
      </div>
    `,
    confirmButtonColor: '#ef4444',
    confirmButtonText: 'Tutup'
  });
  return; // Make sure to return after showing the error
}
    tampilkanDO();
  }

  async function updateStatus(id,value) {
    if (!['LUNAS','BELUM LUNAS'].includes(value)) return alert('Status tidak valid');
    const { error } = await _supabase.from('do_list').update({status:value}).eq('id',id);
    if (error) {
  await Swal.fire({
    icon: 'error',
    title: 'Gagal Update Status',
    html: `
      <div style="text-align:left">
        <p>Terjadi kesalahan saat mengubah status:</p>
        <div style="background:#fef2f2; border-left:4px solid #ef4444; padding:8px 12px; margin:8px 0; border-radius:4px;">
          <code style="color:#b91c1c">${error.message}</code>
        </div>
        <p style="font-size:14px; margin-top:12px">Status tetap tidak berubah.</p>
      </div>
    `,
    confirmButtonColor: '#ef4444',
    confirmButtonText: 'Mengerti'
  });
  
  // Reset select to previous value
  selectElement.value = previousStatus;
  return;
}
    else tampilkanDO();
  }

  function filterBelumLunas() { tampilkanDO('BELUM LUNAS'); }

  async function exportExcel() {
    const { data, error } = await _supabase.from('do_list').select('*,do_items(*)');
    if (error) {
  return Swal.fire({
    icon: 'error',
    title: 'Gagal Memuat Data',
    html: `
      <div style="text-align:left; max-width:100%">
        <p>Terjadi kesalahan saat mengambil data:</p>
        <div style="
          background:#f8f8f8;
          padding:10px;
          border-radius:5px;
          margin:10px 0;
          overflow-x:auto;
          font-family:monospace;
          font-size:13px;
          color:#dc2626;
          border-left:3px solid #ef4444">
          ${error.message.replace(/\n/g, '<br>')}
        </div>
        <p style="font-size:14px; color:#64748b">Silakan refresh halaman atau coba lagi nanti.</p>
      </div>
    `,
    confirmButtonColor: '#22c55e',
    confirmButtonText: 'Mengerti',
    width: '600px'
  });
}
    const exportData=[];
    data.forEach(item=>{
      const total=item.do_items.reduce((s,b)=>s+(b.qty*b.price),0);
      exportData.push({
  "No DO": item.number,
  "Pelanggan": item.customer,
  "Status": item.status,
  "Keterangan": item.keterangan,
  "Total Rp": total.toLocaleString('id-ID')
});
item.do_items.forEach(b => exportData.push({
  "No DO": "",
  "Pelanggan": "‚Üí " + b.name,
  "Status": `${b.qty}√ó${b.unit} @${b.price.toLocaleString('id-ID')}`,
  "Total Rp": (b.qty * b.price).toLocaleString('id-ID')
}));

    });
    const ws=XLSX.utils.json_to_sheet(exportData);
    const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'Rekap DO');
    XLSX.writeFile(wb,'rekap_do.xlsx');
  }

  async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc=new jsPDF();
    doc.text('Rekap DO',10,10);
    let y=20;
    const { data } = await _supabase.from('do_list').select('*,do_items(*)');
    data.forEach(item=>{
      const total=item.do_items.reduce((s,b)=>s+(b.qty*b.price),0);
      doc.text(`${item.number} | ${item.customer} | ${item.status} | Rp ${total.toLocaleString('id-ID')}`,10,y);
      y+=10;
    });
    doc.save('rekap_do.pdf');
  }

  window.onload = () => {
  tampilkanDO();
  document.getElementById('tanggalDO').valueAsDate = new Date(); // ‚¨ÖÔ∏è Tambahan di sini
}
  function setupNavigasiInput() {
  const inputs = ['namaBarang', 'qty', 'unit', 'price'];
  inputs.forEach((id, i) => {
    const el = document.getElementById(id);
    el.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === 'ArrowDown') {
        e.preventDefault();
        if (i + 1 < inputs.length) document.getElementById(inputs[i + 1]).focus();
        else document.querySelector('#barangInputForm button').focus();
      } else if (e.key === 'ArrowUp' && i > 0) {
        e.preventDefault();
        document.getElementById(inputs[i - 1]).focus();
      }
    });
  });
}
function formatRupiah(angka) {
  return angka.toLocaleString('id-ID');
}
function resetFilter() {
  document.getElementById('cariNama').value = '';
  document.getElementById('tanggalCari').value = '';
  tampilkanDO();
}
function formatTanggalIndo(isoDate) {
  const hari = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
  const bulan = [
    'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
    'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
  ];
  const dateObj = new Date(isoDate);
  const hariNama = hari[dateObj.getDay()];
  const tanggal = dateObj.getDate();
  const bulanNama = bulan[dateObj.getMonth()];
  const tahun = dateObj.getFullYear();
  return `${hariNama}, ${tanggal} ${bulanNama} ${tahun}`;
}
function renderBarangTable(row) {
  const isEditing = editingRows.has(row.id);












  const rows = row.do_items.map((item, i) => {
    if (isEditing) {
  return `
    <tr>
      <td>${i + 1}</td>
      <td><input value="${item.name}" data-id="${item.id}" data-field="name" class="edit-input"/></td>
      <td><input type="number" value="${item.qty}" data-id="${item.id}" data-field="qty" class="edit-input"/></td>
      <td><input value="${item.unit}" data-id="${item.id}" data-field="unit" class="edit-input"/></td>
      <td><input type="number" value="${item.price}" data-id="${item.id}" data-field="price" class="edit-input"/></td>
      <td>
        ${(item.qty * item.price).toLocaleString('id-ID')}
        <button onclick="hapusBarang('${item.id}', '${row.id}')" title="Hapus Barang" style="margin-left:8px; background:#ef4444; color:white; font-weight:bold; border:none; border-radius:6px; padding:2px 6px;">üóëÔ∏è</button>
      </td>
    </tr>
  `;
}else {
      return `
      <tr>
        <td>${i + 1}</td>
        <td>${item.name}</td>
        <td>${item.qty}</td>
        <td>${item.unit}</td>
        <td>${item.price.toLocaleString('id-ID')}</td>
        <td>${(item.qty * item.price).toLocaleString('id-ID')}</td>
      </tr>`;
    }
  }).join('');

  const total = row.do_items.reduce((sum, item) => sum + item.qty * item.price, 0);
  const tableHTML = `
  <div class="table-container">
   <table>
      <thead>
        <tr>
          <th>No</th><th>Nama Barang</th><th>Jumlah</th><th>Satuan</th><th>Harga</th><th>Total</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
        <tr style="font-weight:bold; background:#bbf7d0;">
          <td colspan="5" style="text-align:right">Total Nota:</td>
          <td>${total.toLocaleString('id-ID')}</td>
        </tr>
      </tbody>
    </table>
  </div> 
    ${isEditing ? `<button onclick="simpanPerubahan('${row.id}')">üíæ Simpan Perubahan</button>` : ''}
  `;
  return tableHTML;
}

const editingRows = new Set();
function toggleEditBarang(doId) {
  if (editingRows.has(doId)) {
    editingRows.delete(doId);
  } else {
    editingRows.add(doId);
  }
  tampilkanDO(); // Rerender dengan mode edit
}

async function simpanPerubahan(doId) {
  const inputs = document.querySelectorAll(`#barangContainer-${doId} .edit-input`);
  const updates = {};
  inputs.forEach(input => {
    const id = input.dataset.id;
    const field = input.dataset.field;
    const value = field === 'qty' || field === 'price' ? parseFloat(input.value) : input.value;
    if (!updates[id]) updates[id] = {};
    updates[id][field] = value;
  });

  for (const id in updates) {
    const res = await _supabase.from('do_items').update(updates[id]).eq('id', id);
    if (res.error) {
      alert('Gagal update: ' + res.error.message);
      return;
    }
  }

  editingRows.delete(doId);
  tampilkanDO();
}
async function hapusBarang(idBarang, doId) {
  const { isConfirmed } = await Swal.fire({
  title: 'Hapus Barang?',
  text: 'Anda tidak akan bisa mengembalikan data ini!',
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#ef4444',
  cancelButtonColor: '#64748b',
  confirmButtonText: 'Ya, Hapus!',
  cancelButtonText: 'Batal'
});

if (!isConfirmed) return;
  const { error } = await _supabase.from('do_items').delete().eq('id', idBarang);
  if (error) {
    alert('Gagal hapus barang: ' + error.message);
  } else {
    tampilkanDO();
    editingRows.add(doId); // tetap dalam mode edit setelah hapus
  }
}

async function hapusNota(doId) {
  const result = await showConfirm(
    'Hapus Nota', 
    'Yakin ingin menghapus nota ini? Seluruh barang di dalamnya juga akan dihapus.',
    'Ya, Hapus'
  );
  
  if (!result.isConfirmed) return;

  try {
    // Hapus barang-barangnya dulu
    const { error: delItemsError } = await _supabase.from('do_items')
      .delete()
      .eq('do_id', doId);
    
    if (delItemsError) throw delItemsError;

    // Hapus nota utamanya
    const { error: delNotaError } = await _supabase.from('do_list')
      .delete()
      .eq('id', doId);
    
    if (delNotaError) throw delNotaError;

    tampilkanDO();
    showAlert('success', 'Berhasil', 'Nota berhasil dihapus');
    
  } catch (error) {
    showAlert('error', 'Error', 'Gagal menghapus nota: ' + error.message);
  }
}

function filterBelumLunas() {
  tampilkanDO('BELUM LUNAS');
}
function isMobileDevice() {
  return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
}

// Contoh penggunaan:
if (isMobileDevice()) {
  // Lakukan penyesuaian khusus mobile
}
async function tampilkanHutangPelanggan() {
  try {
    // 1. Ambil data hutang dari Supabase
    const { data, error } = await _supabase
      .from('do_list')
      .select(`
        customer,
        date,
        number,
        status,
        do_items (qty, price)
      `)
      .eq('status', 'BELUM LUNAS')
      .order('date', { ascending: false });

    if (error) throw error;
    if (!data || data.length === 0) {
      return Swal.fire({
        title: 'Tidak Ada Hutang',
        text: 'Tidak ditemukan DO yang belum lunas',
        icon: 'info'
      });
    }

    // 2. Proses data hutang
    const hutangPerPelanggan = {};
    let totalSemuaHutang = 0;

    data.forEach(doItem => {
      const totalNota = doItem.do_items.reduce(
        (sum, item) => sum + (item.qty * item.price), 
        0
      );

      if (!hutangPerPelanggan[doItem.customer]) {
        hutangPerPelanggan[doItem.customer] = {
          total: 0,
          transaksi: []
        };
      }

      hutangPerPelanggan[doItem.customer].total += totalNota;
      totalSemuaHutang += totalNota;

      hutangPerPelanggan[doItem.customer].transaksi.push({
        noDO: doItem.number,
        tanggal: formatTanggalIndo(doItem.date),
        jumlah: totalNota
      });
    });

    // 3. Buat HTML content untuk SweetAlert2
    let htmlContent = `
      <style>
        .debt-report {
          max-height: 60vh;
          overflow-y: auto;
          font-family: Tahoma, sans-serif;
          text-align: left;
          padding-right: 10px;
        }
        .customer {
          margin-bottom: 15px;
          border-bottom: 1px solid #e5e7eb;
          padding-bottom: 10px;
        }
        .customer-name {
          color: #14532d;
          font-weight: bold;
          margin-bottom: 5px;
        }
        .transaction {
          margin-left: 15px;
          margin-bottom: 5px;
        }
        .transaction-date {
          color: #64748b;
          font-size: 0.9em;
        }
        .transaction-amount {
          color: #127336;
          font-weight: bold;
        }
        .customer-total {
          color: #dc2626;
          font-weight: bold;
          margin-top: 5px;
        }
        .grand-total {
          color: #b91c1c;
          font-weight: bold;
          font-size: 1.1em;
          margin-top: 20px;
          padding-top: 10px;
          border-top: 2px solid #e5e7eb;
        }
      </style>
      <div class="debt-report">
        <h3 style="color: #14532d; margin-top: 0">Laporan Hutang Pelanggan</h3>
    `;

    // 4. Tambahkan data per pelanggan
    Object.entries(hutangPerPelanggan).forEach(([customer, data], index) => {
      htmlContent += `
        <div class="customer">
          <div class="customer-name">
            ${index + 1}. ${customer}
          </div>
      `;

      // Tambahkan detail transaksi
      data.transaksi.forEach(trans => {
        htmlContent += `
          <div class="transaction">
            ‚Ä¢ ${trans.noDO} 
            <span class="transaction-date">(${trans.tanggal})</span>: 
            <span class="transaction-amount">Rp ${trans.jumlah.toLocaleString('id-ID')}</span>
          </div>
        `;
      });

      // Tambahkan total per pelanggan
      htmlContent += `
          <div class="customer-total">
            Total Hutang: Rp ${data.total.toLocaleString('id-ID')}
          </div>
        </div>
      `;
    });

    // 5. Tambahkan grand total
    htmlContent += `
        <div class="grand-total">
          TOTAL SEMUA HUTANG: Rp ${totalSemuaHutang.toLocaleString('id-ID')}
        </div>
        <div style="margin-top: 15px; color: #64748b; font-size: 0.8em">
          Diperbarui: ${new Date().toLocaleString('id-ID')}
        </div>
      </div>
    `;

    // 6. Tampilkan SweetAlert2
    await Swal.fire({
      title: 'Laporan Hutang',
      html: htmlContent,
      width: 800,
      padding: '20px',
      showConfirmButton: true,
      confirmButtonText: 'Tutup',
      showCancelButton: true,
      cancelButtonText: 'Export Excel',
      background: '#ffffff',
      backdrop: `
        rgba(0,0,0,0.4)
        url("/images/logo-bg.png")
        left center
        no-repeat
      `,
      customClass: {
        container: 'swal-container',
        popup: 'swal-popup',
        header: 'swal-header',
        title: 'swal-title',
        closeButton: 'swal-close',
        content: 'swal-content',
        actions: 'swal-actions'
      }
    }).then((result) => {
      if (result.dismiss === Swal.DismissReason.cancel) {
        exportExcelHutang(hutangPerPelanggan);
      }
    });

  } catch (error) {
    console.error('Error:', error);
    Swal.fire({
      title: 'Error',
      text: 'Gagal memuat data hutang: ' + error.message,
      icon: 'error'
    });
  }
}

// Fungsi pendukung format tanggal
function formatTanggalIndo(isoDate) {
  const hari = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
  const bulan = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
  
  const dateObj = new Date(isoDate);
  const hariNama = hari[dateObj.getDay()];
  const tanggal = dateObj.getDate();
  const bulanNama = bulan[dateObj.getMonth()];
  const tahun = dateObj.getFullYear();
  
  return `${hariNama}, ${tanggal} ${bulanNama} ${tahun}`;
}

function cekHutangPerPelanggan() {
    tampilkanHutangPelanggan();
}

async function exportExcelHutang(hutangPerPelanggan) {
  try {
    // 1. Siapkan data untuk export
    const exportData = [];
    
    // 2. Format data hutang ke dalam array yang sesuai untuk Excel
    Object.entries(hutangPerPelanggan).forEach(([customer, data], index) => {
      // Tambahkan header pelanggan
      exportData.push({
        'No': index + 1,
        'Pelanggan': customer,
        'No DO': '',
        'Tanggal': '',
        'Jumlah Hutang': '',
        'Status': ''
      });
      
      // Tambahkan detail transaksi per pelanggan
      data.transaksi.forEach(trans => {
        exportData.push({
          'No': '',
          'Pelanggan': '',
          'No DO': trans.noDO,
          'Tanggal': trans.tanggal,
          'Jumlah Hutang': trans.jumlah,
          'Status': 'BELUM LUNAS'
        });
      });
      
      // Tambahkan total per pelanggan
      exportData.push({
        'No': '',
        'Pelanggan': 'TOTAL',
        'No DO': '',
        'Tanggal': '',
        'Jumlah Hutang': data.total,
        'Status': ''
      });
      
      // Tambahkan baris kosong sebagai pembatas
      exportData.push({});
    });
    
    // 3. Hitung grand total
    const grandTotal = Object.values(hutangPerPelanggan).reduce(
      (sum, data) => sum + data.total, 0
    );
    
    exportData.push({
      'No': '',
      'Pelanggan': 'GRAND TOTAL SEMUA HUTANG',
      'No DO': '',
      'Tanggal': '',
      'Jumlah Hutang': grandTotal,
      'Status': ''
    });
    
    // 4. Buat worksheet Excel
    const ws = XLSX.utils.json_to_sheet(exportData, {
      header: ['No', 'Pelanggan', 'No DO', 'Tanggal', 'Jumlah Hutang', 'Status'],
      skipHeader: false
    });
    
    // 5. Atur lebar kolom
    ws['!cols'] = [
      { wch: 5 },   // No
      { wch: 30 },  // Pelanggan
      { wch: 15 },  // No DO
      { wch: 20 },  // Tanggal
      { wch: 15 },  // Jumlah Hutang
      { wch: 15 }   // Status
    ];
    
    // 6. Buat workbook dan simpan file
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Laporan Hutang');
    
    // 7. Generate nama file dengan tanggal
    const tanggal = new Date().toISOString().slice(0, 10).replace(/-/g, '');
    const fileName = `Laporan_Hutang_${tanggal}.xlsx`;
    
    XLSX.writeFile(wb, fileName);
    
    // 8. Notifikasi sukses
    Swal.fire({
      title: 'Export Berhasil',
      text: `File ${fileName} berhasil diunduh`,
      icon: 'success',
      timer: 3000
    });
    
  } catch (error) {
    console.error('Export error:', error);
    Swal.fire({
      title: 'Export Gagal',
      text: 'Terjadi kesalahan saat mengekspor data: ' + error.message,
      icon: 'error'
    });
  }
}
// Fungsi untuk menampilkan notifikasi umum
function showAlert(icon, title, text, timer = 3000) {
  return Swal.fire({
    icon: icon,
    title: title,
    text: text,
    timer: timer,
    showConfirmButton: false,
    toast: true,
    position: 'top-end'
  });
}

// Fungsi untuk konfirmasi
async function showConfirm(title, text, confirmText = 'Ya', cancelText = 'Batal') {
  return Swal.fire({
    title: title,
    text: text,
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#22c55e',
    cancelButtonColor: '#ef4444',
    confirmButtonText: confirmText,
    cancelButtonText: cancelText
  });
}
async function editKeterangan(doId) {
  // Ambil keterangan saat ini
  const currentKeterangan = document.getElementById(`keterangan-${doId}`)
    .textContent.replace('‚úèÔ∏è Edit', '').trim();
  
  const { value: newKeterangan } = await Swal.fire({
    title: 'Edit Keterangan',
    input: 'textarea',
    inputValue: currentKeterangan === '-' ? '' : currentKeterangan,
    inputPlaceholder: 'Masukkan keterangan DO...',
    showCancelButton: true,
    inputValidator: (value) => {
      if (value && value.length > 500) {
        return 'Keterangan maksimal 500 karakter!';
      }
    }
  });

  if (newKeterangan !== undefined) {
    try {
      // Update di database
      const { error } = await _supabase
        .from('do_list')
        .update({ keterangan: newKeterangan || null })
        .eq('id', doId);
      
      if (error) throw error;
      
      // Update tampilan
      document.getElementById(`keterangan-${doId}`).innerHTML = 
        `${newKeterangan || '-'} <button onclick="editKeterangan('${doId}')" class="edit-btn">‚úèÔ∏è Edit</button>`;
      
      Swal.fire('Berhasil!', 'Keterangan telah diperbarui', 'success');
    } catch (error) {
      Swal.fire('Error!', `Gagal update: ${error.message}`, 'error');
    }
  }
}







</script>
</body>
</html>
